<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="format-detection" content="telephone=no" />
<meta name="viewport"
	content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
	<link rel="stylesheet" href="css/index.css" ><title>Bus tracker - Rosario</title>

</head>
<body onload="onLoad()">
<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/admob.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js" ></script>
	<script>
	    if (typeof jQuery == "undefined") {
	        var script = document.createElement("script");
	        script.src = "http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.11.3.min.js";
	        document.write(script.outerHTML);
	    }
    </script>

<script type="text/javascript" src="js/json2-min.js"></script>
<script type="text/javascript" src="js/utility.js"></script>
<script type="text/javascript" src="js/persist.js"></script>


	 <div class="cabeza">
        <h2>Cuando Llega Mi Rosario Bus</h2>
              <!--<a id="link-favoritos" href="Favoritos.aspx" >Favoritos</a>-->
    </div>
    
    <div class="linea-cabeza">
    </div>
    
    <div id="div-calc-prov" class="seleccion" >
        <span>Provincia o grupo:</span>
        <select id="ddprovs" >
            <option value="TODAS">TODAS</option>
            <option value="BSAS">BUENOS AIRES</option>
            <option value="ROSARIO">ROSARIO Y ALREDEDORES</option>
            <option value="STAFE">SANTA FE</option>
        </select>
    </div>
    
    <div id="div-calc-locs" class="seleccion" >
        <span>Localidad</span>
        <select id="ddlocs" >
            <option value="...">...</option>
        </select>
    </div>
    
    <div id="div-calc-lineas" class="seleccion" >
        <span>LÃ­nea</span>
        <select id="ddlins"></select>
    </div>
    
    <div id="div-calc-calles" class="seleccion" >
        <span>Calle</span>
        <select id="ddcalles"></select>
    </div>
    
    <div id="div-calc-cruces" class="seleccion" >
        <span>Cruce</span>
        <select id="ddcruces"></select>
    </div>
    
    <div id="div-calc-result">
    </div>
    
	<script>
	    (function() {
	        var methods = ["assert", "cd", "clear", "count", "countReset",
	        "debug", "dir", "dirxml", "error", "exception", "group",
	        "groupCollapsed", "groupEnd", "info", "log", "markTimeline",
	        "profile", "profileEnd", "select", "table", "time", "timeEnd",
	        "timeStamp", "timeline", "timelineEnd", "trace", "warn"];
	        var length = methods.length;
	        var console = (window.console = window.console || {});
	        var method;
	        var nop = function() { };
	        while (length--) {
	            method = methods[length];
	            if (!console[method])
	                console[method] = nop;
	        }
	    })();

	    $(document).ready(function() {
	        var store = new Persist.Store("CuandoLlegaBus");

	        // variables
	        var valorProvs = "",
	            valorLocal = "",
	            valorLinea = "",
	            valorCalle = "",
	            valorCruce = "";

	        //var dameFavoActual = function() {
	        //    return AleFavos.create(
	        //        "",
	        //        valorLocal,
	        //        valorLinea,
	        //        valorCalle,
	        //        valorCruce
	        //    );
	        //};

	        //var favoritar = function() {
	        //    AleFavos.add(dameFavoActual());
	        //    $(".favobtn").fadeOut(function() {
	        //        $(".favolnk").fadeIn();
	        //    });
	        //};

	        var objCalculo = {
	            run: function(postParams) {
	                if (typeof this.xhr !== "undefined") {
	                    try { this.xhr.abort(); }
	                    catch (err) { }
	                }
	                this.xhr = $.post(
                        "http://cuandollegabus.com/Calculo.aspx",
                        postParams,
                        function(data) {
                            $("#div-calc-result").empty();
                            $("#div-calc-result").append(data);
                            //var favoActual = dameFavoActual();
                            //if (AleFavos.exists(favoActual)) {
                            //    $(".favolnk").show();
                            //} else {
                            //    $(".favobtn").show();
                            //}
                        },
                        "html"
                    );
	            }
	        };

	        var calcular = function() {
	            objCalculo.run({
	                local: valorLocal,
	                linea: valorLinea,
	                calle: valorCalle,
	                cruce: valorCruce
	            });
	        };

	        var onCambioProvincias = function() {
	            valorProvs = $("#ddprovs").val();
	            store.set("provs", valorProvs);
	            $("#ddlocs").empty();
	            $("#ddlins").empty();
	            $("#ddcalles").empty();
	            $("#ddcruces").empty();
	            $("#div-calc-result").empty();
	            var i, j;
	            AleUtil.addSelectOption("#ddlocs", "...");
	            for (i = 0; i < AleUtil.localidades.length; i++) {
	                var grupos = AleUtil.localidades[i].grupos;
	                for (j = 0; j < grupos.length; j++) {
	                    if (grupos[j] === valorProvs) {
	                        AleUtil.addSelectOption("#ddlocs", AleUtil.localidades[i].nombre);
	                    }
	                }
	            }
	        };

	        var onCambioLocalidades = function() {
	            valorLocal = $("#ddlocs").val();
	            store.set("local", valorLocal);
	            $("#ddlins").empty();
	            $("#ddcalles").empty();
	            $("#ddcruces").empty();
	            $("#div-calc-result").empty();
	            if (valorLocal !== "...") {
	                AleUtil.cargarSelectConAjax({
	                    method: "POST",
	                    url: "http://cuandollegabus.com/Lins.aspx",
	                    data: { local: valorLocal },
	                    selector: "#ddlins",
	                    valName: ".",
	                    txtName: "."
	                });
	            }
	        };

	        var onCambioLineas = function() {
	            valorLinea = $("#ddlins").val();
	            $("#ddcalles").empty();
	            $("#ddcruces").empty();
	            $("#div-calc-result").empty();
	            if (valorLinea !== "...") {
	                AleUtil.cargarSelectConAjax({
	                    method: "POST",
	                    url: "http://cuandollegabus.com/Calles.aspx",
	                    data: {
	                        local: valorLocal,
	                        linea: valorLinea
	                    },
	                    selector: "#ddcalles",
	                    valName: ".",
	                    txtName: "."
	                });
	            }
	        };

	        var onCambioCalles = function() {
	            valorCalle = $("#ddcalles").val();
	            $("#ddcruces").empty();
	            $("#div-calc-result").empty();
	            if (valorCalle !== "...") {
	                AleUtil.cargarSelectConAjax({
	                    method: "POST",
	                    url: "http://cuandollegabus.com/Cruces.aspx",
	                    data: {
	                        local: valorLocal,
	                        linea: valorLinea,
	                        calle: valorCalle
	                    },
	                    selector: "#ddcruces",
	                    valName: ".",
	                    txtName: "."
	                });
	            }
	        };

	        var onCambioCruces = function() {
	            valorCruce = $("#ddcruces").val();
	            $("#div-calc-result").empty();
	            if (valorCruce !== "...") {
	                calcular();
	            }
	        };

	        // seteo eventos
	        $("#ddprovs").change(onCambioProvincias);
	        $("#ddlocs").change(onCambioLocalidades);
	        $("#ddlins").change(onCambioLineas);
	        $("#ddcalles").change(onCambioCalles);
	        $("#ddcruces").change(onCambioCruces);

	        $(document).on("click", ".recalc", function() {
	            calcular();
	        });

	        //$(document).on("click", ".favobtn", function() {
	        //    favoritar();
	        //});

	        // trabajo en inicio...
	        if (store.get("provs") != null) {
	            $("#ddprovs").val(store.get("provs"));
	        }

	        onCambioProvincias();

	        if (store.get("local") != null) {
	            $("#ddlocs").val(store.get("local"));
	            onCambioLocalidades();
	        } else {
	            $("#ddlocs").val("...");
	        }
	    });
	</script>
  
</body>
</html>
